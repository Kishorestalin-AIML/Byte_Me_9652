<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMERGENCY - Ambulance Traffic Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        :root {
            --bg-primary: #0a0f14;
            --bg-secondary: #111921;
            --bg-card: #151d27;
            --bg-elevated: #1a242f;
            --fg-primary: #f0f4f8;
            --fg-secondary: #8899a8;
            --fg-muted: #5a6a7a;
            --accent-emergency: #00ff88;
            --accent-police: #00a8ff;
            --accent-alert: #ff4757;
            --accent-warning: #ffa726;
            --border: #253040;
            --glow-emergency: rgba(0, 255, 136, 0.15);
            --glow-police: rgba(0, 168, 255, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--fg-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'Space Grotesk', sans-serif;
        }

        /* Background Pattern */
        .bg-grid {
            background-image:
                linear-gradient(rgba(0, 255, 136, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 136, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--fg-muted);
        }

        /* Form Inputs */
        .input-field {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--fg-primary);
            font-size: 15px;
            transition: all 0.3s ease;
            outline: none;
        }

        .input-field:focus {
            border-color: var(--accent-emergency);
            box-shadow: 0 0 0 3px var(--glow-emergency);
        }

        .input-field::placeholder {
            color: var(--fg-muted);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px 28px;
            border-radius: 10px;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            outline: none;
        }

        .btn-primary {
            background: var(--accent-emergency);
            color: var(--bg-primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 255, 136, 0.3);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--fg-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--accent-emergency);
            background: var(--bg-card);
        }

        .btn-danger {
            background: var(--accent-alert);
            color: white;
        }

        .btn-danger:hover {
            box-shadow: 0 8px 30px rgba(255, 71, 87, 0.3);
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: rgba(0, 255, 136, 0.3);
        }

        /* Signal Indicator */
        .signal-light {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.5s ease;
        }

        .signal-light::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 2px solid;
            opacity: 0.5;
        }

        .signal-red {
            background: radial-gradient(circle, #ff4757 0%, #c0392b 100%);
            box-shadow: 0 0 40px rgba(255, 71, 87, 0.6);
        }

        .signal-red::before {
            border-color: #ff4757;
        }

        .signal-yellow {
            background: radial-gradient(circle, #ffa726 0%, #e67e22 100%);
            box-shadow: 0 0 40px rgba(255, 167, 38, 0.6);
        }

        .signal-yellow::before {
            border-color: #ffa726;
        }

        .signal-green {
            background: radial-gradient(circle, #00ff88 0%, #00cc6a 100%);
            box-shadow: 0 0 40px rgba(0, 255, 136, 0.6);
            animation: pulse-green 2s infinite;
        }

        .signal-green::before {
            border-color: #00ff88;
        }

        @keyframes pulse-green {

            0%,
            100% {
                box-shadow: 0 0 40px rgba(0, 255, 136, 0.6);
            }

            50% {
                box-shadow: 0 0 60px rgba(0, 255, 136, 0.9);
            }
        }

        /* Status Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .status-waiting {
            background: rgba(255, 167, 38, 0.15);
            color: var(--accent-warning);
        }

        .status-green {
            background: rgba(0, 255, 136, 0.15);
            color: var(--accent-emergency);
        }

        /* Map */
        #liveMap {
            height: 300px;
            width: 100%;
            border-radius: 0.75rem;
            z-index: 1;
        }

        /* Leaflet Dark Theme Overrides */
        .leaflet-container {
            background: var(--bg-card);
        }

        .leaflet-tile {
            filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
        }

        .leaflet-control-attribution {
            background: rgba(0, 0, 0, 0.5) !important;
            color: #aaa !important;
        }

        .leaflet-control-attribution a {
            color: #aaa !important;
        }

        .status-cleared {
            background: rgba(0, 168, 255, 0.15);
            color: var(--accent-police);
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            background: var(--bg-elevated);
            border: 1px solid var(--accent-emergency);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            transform: translateX(120%);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 380px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-alert {
            border-color: var(--accent-alert);
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            height: 100vh;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            position: fixed;
            left: 0;
            top: 0;
            padding: 24px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            z-index: 100;
        }

        .sidebar-hidden {
            transform: translateX(-100%);
        }

        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            padding: 32px;
            transition: margin-left 0.3s ease;
        }

        .main-content-expanded {
            margin-left: 0;
        }

        /* Map Container */
        .map-container {
            width: 100%;
            height: 300px;
            background: var(--bg-secondary);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .map-grid {
            position: absolute;
            inset: 0;
            background-image:
                linear-gradient(rgba(0, 255, 136, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 136, 0.1) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .map-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.5s ease;
        }

        .marker-ambulance {
            background: var(--accent-emergency);
            box-shadow: 0 0 20px var(--accent-emergency);
        }

        .marker-police {
            background: var(--accent-police);
            box-shadow: 0 0 20px var(--accent-police);
        }

        .marker-signal {
            background: var(--accent-alert);
            width: 16px;
            height: 16px;
        }

        /* Photo Upload */
        .photo-upload {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--bg-elevated);
            border: 3px dashed var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
        }

        .photo-upload:hover {
            border-color: var(--accent-emergency);
        }

        .photo-upload img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Countdown Timer */
        .countdown {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 48px;
            font-weight: 700;
            color: var(--accent-emergency);
            text-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .animate-fadeInUp {
            animation: fadeInUp 0.6s ease forwards;
        }

        .animate-slideIn {
            animation: slideIn 0.4s ease forwards;
        }

        .delay-1 {
            animation-delay: 0.1s;
        }

        .delay-2 {
            animation-delay: 0.2s;
        }

        .delay-3 {
            animation-delay: 0.3s;
        }

        .delay-4 {
            animation-delay: 0.4s;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .mobile-menu-btn {
                display: flex !important;
            }
        }

        @media (max-width: 640px) {
            .countdown {
                font-size: 36px;
            }

            .signal-light {
                width: 48px;
                height: 48px;
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Focus States */
        *:focus-visible {
            outline: 2px solid var(--accent-emergency);
            outline-offset: 2px;
        }

        /* Emergency Pulse Animation */
        .emergency-pulse {
            animation: emergencyPulse 1s infinite;
        }

        @keyframes emergencyPulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(255, 71, 87, 0.7);
            }

            50% {
                box-shadow: 0 0 0 15px rgba(255, 71, 87, 0);
            }
        }

        /* Tab System */
        .tab-btn {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: var(--fg-secondary);
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: var(--accent-emergency);
            border-bottom-color: var(--accent-emergency);
        }

        .tab-btn:hover {
            color: var(--fg-primary);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            width: 100%;
            max-width: 400px;
            transform: scale(0.95);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
    </style>
</head>

<body class="bg-grid">

    <!-- Toast Notification Container -->
    <div id="toast" class="toast" role="alert" aria-live="polite">
        <div class="flex items-start gap-3">
            <div id="toast-icon" class="mt-1"></div>
            <div>
                <h4 id="toast-title" class="font-semibold text-base"></h4>
                <p id="toast-message" class="text-sm text-[var(--fg-secondary)] mt-1"></p>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-semibold">Settings</h3>
                <button id="closeSettingsBtn" class="p-2 hover:bg-[var(--bg-elevated)] rounded-full transition-colors">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--fg-secondary)"
                        stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>

            <div class="space-y-4">
                <div class="p-4 rounded-xl bg-[var(--bg-elevated)] border border-[var(--border)]">
                    <div class="flex items-center gap-3 mb-2">
                        <div
                            class="w-10 h-10 rounded-full bg-[var(--bg-secondary)] flex items-center justify-center text-[var(--fg-secondary)]">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                <circle cx="12" cy="7" r="4" />
                            </svg>
                        </div>
                        <div>
                            <p class="font-medium" id="settingsUsername">User01</p>
                            <p class="text-xs text-[var(--fg-secondary)]" id="settingsRole">Role</p>
                        </div>
                    </div>
                </div>

                <button id="modalLogoutBtn"
                    class="flex items-center gap-3 w-full p-4 rounded-xl hover:bg-[var(--bg-elevated)] text-[var(--fg-secondary)] transition-colors text-left">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" y1="12" x2="9" y2="12" />
                    </svg>
                    <span>Logout</span>
                </button>

                <button id="deleteAccountBtn"
                    class="flex items-center gap-3 w-full p-4 rounded-xl hover:bg-[rgba(255,71,87,0.1)] text-[var(--accent-alert)] transition-colors text-left">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18" />
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                        <line x1="10" y1="11" x2="10" y2="17" />
                        <line x1="14" y1="11" x2="14" y2="17" />
                    </svg>
                    <span>Delete Account</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md">
            <!-- Logo -->
            <div class="text-center mb-8 animate-fadeInUp">
                <div
                    class="inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-[var(--bg-card)] border border-[var(--border)] mb-4">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--accent-emergency)"
                        stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                    </svg>
                </div>
                <h1 class="text-3xl font-bold mb-2">EMERGENCY</h1>
                <p class="text-[var(--fg-secondary)]">Ambulance Traffic Management System</p>
            </div>

            <!-- Login Form -->
            <div class="card animate-fadeInUp delay-1" style="opacity: 0;">
                <!-- Tabs -->
                <div class="flex border-b border-[var(--border)] mb-6">
                    <button class="tab-btn active" data-tab="login" type="button">Login</button>
                    <button class="tab-btn" data-tab="register" type="button">Register</button>
                </div>

                <!-- Login Tab -->
                <div id="loginTab" class="tab-content">
                    <form id="loginForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Username</label>
                            <input type="text" id="loginUsername" class="input-field" placeholder="Enter username"
                                required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Password</label>
                            <input type="password" id="loginPassword" class="input-field" placeholder="Enter password"
                                required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Role</label>
                            <select id="loginRole" class="input-field cursor-pointer">
                                <option value="">Select your role</option>
                                <option value="driver">Ambulance Driver</option>
                                <option value="police">Traffic Police</option>
                                <option value="hospital">Hospital Manager</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary w-full mt-6">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
                                <polyline points="10 17 15 12 10 7" />
                                <line x1="15" y1="12" x2="3" y2="12" />
                            </svg>
                            Sign In
                        </button>
                    </form>
                </div>

                <!-- Register Tab -->
                <div id="registerTab" class="tab-content hidden">
                    <form id="registerForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Full Name</label>
                            <input type="text" id="regName" class="input-field" placeholder="Enter full name" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Username</label>
                            <input type="text" id="regUsername" class="input-field" placeholder="Choose username"
                                required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Password</label>
                            <input type="password" id="regPassword" class="input-field" placeholder="Create password"
                                required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Phone
                                Number</label>
                            <div class="flex gap-2">
                                <input type="tel" id="regPhone" class="input-field flex-1" placeholder="+1 234 567 8900"
                                    required>
                                <button type="button" id="verifyPhoneBtn"
                                    class="btn btn-secondary whitespace-nowrap">Verify</button>
                            </div>
                        </div>
                        <div id="phoneVerifySection" class="hidden">
                            <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Verification
                                Code</label>
                            <div class="flex gap-2">
                                <input type="text" id="verifyCode" class="input-field flex-1"
                                    placeholder="Enter 6-digit code" maxlength="6">
                                <button type="button" id="confirmVerifyBtn" class="btn btn-primary">Confirm</button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Date of
                                Birth</label>
                            <input type="date" id="regDob" class="input-field" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Role</label>
                            <select id="regRole" class="input-field cursor-pointer" required>
                                <option value="">Select your role</option>
                                <option value="driver">Ambulance Driver</option>
                                <option value="police">Traffic Police</option>
                                <option value="hospital">Hospital Manager</option>
                            </select>
                        </div>

                        <!-- Role-specific fields -->
                        <div id="driverFields" class="hidden space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Vehicle
                                    Type</label>
                                <select id="regVehicleType" class="input-field cursor-pointer">
                                    <option value="">Select vehicle type</option>
                                    <option value="Basic Ambulance">Basic Ambulance</option>
                                    <option value="Advanced Life Support">Advanced Life Support</option>
                                    <option value="Patient Transport">Patient Transport</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Number
                                    Plate</label>
                                <input type="text" id="regPlate" class="input-field" placeholder="AMB-1234">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">License
                                    Number</label>
                                <input type="text" id="regLicense" class="input-field" placeholder="DL-2024-XXXXX">
                            </div>
                        </div>

                        <div id="policeFields" class="hidden space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Force
                                    Number</label>
                                <input type="text" id="regForceNumber" class="input-field" placeholder="TN-TP-XXXX">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Assigned
                                    Signal</label>
                                <select id="regSignal" class="input-field cursor-pointer">
                                    <option value="">Select signal</option>
                                    <option value="SIG-001">Main Street Junction</option>
                                    <option value="SIG-002">Hospital Road Crossing</option>
                                    <option value="SIG-003">City Center Signal</option>
                                    <option value="SIG-004">Highway Entry Point</option>
                                </select>
                            </div>
                        </div>

                        <div id="hospitalFields" class="hidden space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Hospital
                                    Name</label>
                                <input type="text" id="regHospitalName" class="input-field"
                                    placeholder="City General Hospital">
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Locality</label>
                                <input type="text" id="regHospitalArea" class="input-field" placeholder="Downtown">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Facility
                                    Type</label>
                                <select id="regHospitalType" class="input-field cursor-pointer">
                                    <option value="">Select type</option>
                                    <option value="General">General Hospital</option>
                                    <option value="Trauma Center">Trauma Center</option>
                                    <option value="Specialty">Specialty Clinic</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-full mt-6">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                <circle cx="8.5" cy="7" r="4" />
                                <line x1="20" y1="8" x2="20" y2="14" />
                                <line x1="23" y1="11" x2="17" y2="11" />
                            </svg>
                            Create Account
                        </button>
                    </form>
                </div>
            </div>

            <!-- Demo Credentials -->
            <div class="mt-6 p-4 bg-[var(--bg-card)] rounded-xl border border-[var(--border)] animate-fadeInUp delay-2"
                style="opacity: 0;">
                <p class="text-sm text-[var(--fg-secondary)] text-center">
                    <span class="text-[var(--accent-emergency)]">Demo:</span>
                    Use any username/password with role selection
                </p>
            </div>
        </div>
    </div>

    <!-- Ambulance Driver Dashboard -->
    <div id="driverDashboard" class="hidden">
        <!-- Sidebar -->
        <aside class="sidebar" id="driverSidebar">
            <div class="flex items-center gap-3 mb-8">
                <div class="w-10 h-10 rounded-xl bg-[var(--accent-emergency)] flex items-center justify-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--bg-primary)"
                        stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                    </svg>
                </div>
                <span class="font-bold text-lg">EMERGENCY</span>
            </div>

            <!-- Profile Section -->
            <div class="flex flex-col items-center mb-8">
                <div class="photo-upload" id="driverPhotoUpload">
                    <input type="file" id="driverPhotoInput" accept="image/*" class="hidden">
                    <img id="driverPhotoPreview" class="hidden" alt="Profile photo">
                    <div id="driverPhotoPlaceholder" class="text-center">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--fg-muted)"
                            stroke-width="1.5" class="mx-auto mb-1">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                            <circle cx="8.5" cy="8.5" r="1.5" />
                            <polyline points="21 15 16 10 5 21" />
                        </svg>
                        <span class="text-xs text-[var(--fg-muted)]">Upload</span>
                    </div>
                </div>
                <h3 id="driverWelcomeName" class="font-semibold mt-3"></h3>
                <p class="text-sm text-[var(--fg-secondary)]">Ambulance Driver</p>
            </div>

            <!-- Navigation -->
            <nav class="flex-1">
                <ul class="space-y-2">
                    <li>
                        <a href="#"
                            class="flex items-center gap-3 px-4 py-3 rounded-xl bg-[var(--bg-elevated)] text-[var(--accent-emergency)]">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="3" y="3" width="7" height="7" />
                                <rect x="14" y="3" width="7" height="7" />
                                <rect x="14" y="14" width="7" height="7" />
                                <rect x="3" y="14" width="7" height="7" />
                            </svg>
                            Dashboard
                        </a>
                    </li>
                    <li>
                        <a href="#"
                            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-[var(--bg-elevated)] text-[var(--fg-secondary)] transition-colors">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                                <circle cx="12" cy="10" r="3" />
                            </svg>
                            Location
                        </a>
                    </li>
                    <li>
                        <a href="#"
                            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-[var(--bg-elevated)] text-[var(--fg-secondary)] transition-colors">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                                <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                            </svg>
                            Alerts
                            <span id="driverAlertCount"
                                class="ml-auto bg-[var(--accent-alert)] text-white text-xs px-2 py-0.5 rounded-full hidden">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="driverSettingsBtn"
                            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-[var(--bg-elevated)] text-[var(--fg-secondary)] transition-colors">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="3" />
                                <path
                                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                            </svg>
                            Settings
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Logout -->
            <button id="driverLogout" class="btn btn-secondary w-full mt-4">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                    <polyline points="16 17 21 12 16 7" />
                    <line x1="21" y1="12" x2="9" y2="12" />
                </svg>
                Logout
            </button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Mobile Menu Button -->
            <button id="driverMobileMenu"
                class="mobile-menu-btn hidden fixed top-4 left-4 z-50 w-10 h-10 rounded-xl bg-[var(--bg-card)] border border-[var(--border)] items-center justify-center lg:hidden">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12" />
                    <line x1="3" y1="6" x2="21" y2="6" />
                    <line x1="3" y1="18" x2="21" y2="18" />
                </svg>
            </button>

            <!-- Header -->
            <header class="flex items-center justify-between mb-8 animate-fadeInUp">
                <div>
                    <h1 class="text-2xl font-bold">Driver Dashboard</h1>
                    <p class="text-[var(--fg-secondary)]">Manage your emergency routes</p>
                </div>
                <div id="driverCurrentTime" class="text-right">
                    <div class="text-2xl font-bold font-['Space_Grotesk']"></div>
                    <div class="text-sm text-[var(--fg-secondary)]"></div>
                </div>
            </header>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div class="card animate-fadeInUp delay-1" style="opacity: 0;">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-[rgba(0,255,136,0.15)] flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-emergency)"
                                stroke-width="2">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                            </svg>
                        </div>
                        <span class="text-sm text-[var(--fg-secondary)]">Status</span>
                    </div>
                    <p id="driverStatusText" class="text-xl font-bold">Waiting</p>
                </div>

                <div class="card animate-fadeInUp delay-2" style="opacity: 0;">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-[rgba(0,168,255,0.15)] flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-police)"
                                stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                            </svg>
                        </div>
                        <span class="text-sm text-[var(--fg-secondary)]">Vehicle</span>
                    </div>
                    <p id="driverVehicleDisplay" class="text-xl font-bold">--</p>
                </div>

                <div class="card animate-fadeInUp delay-3" style="opacity: 0;">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-[rgba(255,167,38,0.15)] flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-warning)"
                                stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                                <circle cx="12" cy="10" r="3" />
                            </svg>
                        </div>
                        <span class="text-sm text-[var(--fg-secondary)]">Speed</span>
                    </div>
                    <p id="driverSpeedDisplay" class="text-xl font-bold">0 <span class="text-sm font-normal">km/h</span>
                    </p>
                </div>

                <div class="card animate-fadeInUp delay-4" style="opacity: 0;">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-[rgba(255,71,87,0.15)] flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-alert)"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <polyline points="12 6 12 12 16 14" />
                            </svg>
                        </div>
                        <span class="text-sm text-[var(--fg-secondary)]">ETA</span>
                    </div>
                    <p id="driverEtaDisplay" class="text-xl font-bold">-- <span class="text-sm font-normal">min</span>
                    </p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Left Column -->
                <div class="space-y-6">
                    <!-- Profile Card -->
                    <div class="card animate-fadeInUp" style="opacity: 0; animation-delay: 0.3s;">
                        <h3 class="font-semibold mb-4 flex items-center justify-between gap-2">
                            <div class="flex items-center gap-2">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                    stroke="var(--accent-emergency)" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                    <circle cx="12" cy="7" r="4" />
                                </svg>
                                Driver Information
                            </div>
                            <button id="editDriverProfileBtn"
                                class="text-xs text-[var(--accent-police)] hover:text-white transition-colors">
                                Edit Profile
                            </button>
                        </h3>
                        <div class="grid grid-cols-2 gap-4" id="driverProfileView">
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">Full Name</p>
                                <p id="driverInfoName" class="font-medium">--</p>
                            </div>
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">Phone</p>
                                <p id="driverInfoPhone" class="font-medium">--</p>
                            </div>
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">Vehicle Type</p>
                                <p id="driverInfoVehicle" class="font-medium">--</p>
                            </div>
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">Number Plate</p>
                                <p id="driverInfoPlate" class="font-medium">--</p>
                            </div>
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">License No.</p>
                                <p id="driverInfoLicense" class="font-medium">--</p>
                            </div>
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">Language</p>
                                <p id="driverInfoLanguage" class="font-medium">English</p>
                            </div>
                        </div>

                        <!-- Edit Form (Hidden) -->
                        <form id="driverProfileForm" class="hidden space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-[var(--fg-secondary)] mb-1">Phone</label>
                                    <input type="tel" id="editDriverPhone" class="input-field text-sm p-2" required>
                                </div>
                                <div>
                                    <label class="block text-xs text-[var(--fg-secondary)] mb-1">Language</label>
                                    <select id="editDriverLanguage" class="input-field text-sm p-2 cursor-pointer">
                                        <option value="English">English</option>
                                        <option value="Tamil">Tamil</option>
                                        <option value="Hindi">Hindi</option>
                                    </select>
                                </div>
                                <div class="col-span-2">
                                    <label class="block text-xs text-[var(--fg-secondary)] mb-1">Emergency
                                        Contact</label>
                                    <input type="text" id="editDriverEmergency" class="input-field text-sm p-2"
                                        placeholder="Name & Phone">
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button type="button" id="cancelDriverEditBtn"
                                    class="btn btn-secondary flex-1 text-sm py-1.5">Cancel</button>
                                <button type="submit" class="btn btn-primary flex-1 text-sm py-1.5">Save
                                    Changes</button>
                            </div>
                        </form>
                    </div>

                    <!-- Emergency Signal -->
                    <div class="card animate-fadeInUp" style="opacity: 0; animation-delay: 0.4s;">
                        <h3 class="font-semibold mb-4 flex items-center gap-2">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent-alert)"
                                stroke-width="2">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
                            </svg>
                            Emergency Signal
                        </h3>

                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Select Target
                                Signal</label>
                            <select id="targetSignalSelect" class="input-field cursor-pointer">
                                <option value="">Choose nearest signal</option>
                                <option value="SIG-001">Main Street Junction (0.5 km)</option>
                                <option value="SIG-002">Hospital Road Crossing (1.2 km)</option>
                                <option value="SIG-003">City Center Signal (2.0 km)</option>
                                <option value="SIG-004">Highway Entry Point (3.5 km)</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Message to Traffic
                                Police</label>
                            <textarea id="emergencyMessage" class="input-field resize-none" rows="3"
                                placeholder="Emergency details..."></textarea>
                        </div>

                        <button id="sendEmergencyBtn" class="btn btn-primary w-full">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M22 2L11 13" />
                                <polygon points="22 2 15 22 11 13 2 9 22 2" />
                            </svg>
                            Send Emergency Signal
                        </button>
                    </div>

                    <!-- Signal Status -->
                    <div class="card animate-fadeInUp" style="opacity: 0; animation-delay: 0.5s;">
                        <h3 class="font-semibold mb-4 flex items-center gap-2">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent-emergency)"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <polyline points="12 6 12 12 16 14" />
                            </svg>
                            Signal Status
                        </h3>

                        <div class="flex items-center justify-between mb-4">
                            <div id="driverSignalStatus" class="status-badge status-waiting">
                                <span class="w-2 h-2 rounded-full bg-current"></span>
                                Waiting
                            </div>
                            <div class="signal-light signal-red" id="driverSignalLight">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="3" />
                                </svg>
                            </div>
                        </div>

                        <div id="driverSignalMessage" class="text-sm text-[var(--fg-secondary)]">
                            Select a signal and send emergency request
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="space-y-6">
                    <!-- Live Location -->
                    <div class="card animate-fadeInUp" style="opacity: 0; animation-delay: 0.3s;">
                        <h3 class="font-semibold mb-4 flex items-center gap-2">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent-police)"
                                stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                                <circle cx="12" cy="10" r="3" />
                            </svg>
                            Live Location
                        </h3>
                        <div class="map-container">
                            <div class="map-grid"></div>
                            <div id="driverMapMarker" class="map-marker marker-ambulance" style="top: 50%; left: 50%;">
                            </div>
                            <div class="map-marker marker-signal" style="top: 30%; left: 70%;" title="Signal 1"></div>
                            <div class="map-marker marker-signal" style="top: 60%; left: 25%;" title="Signal 2"></div>
                            <div class="map-marker marker-signal" style="top: 80%; left: 80%;" title="Signal 3"></div>
                        </div>
                        <div class="mt-4 grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-[var(--fg-muted)] mb-1">LATITUDE</p>
                                <p id="driverLat" class="font-mono text-sm">--</p>
                            </div>
                            <div>
                                <p class="text-xs text-[var(--fg-muted)] mb-1">LONGITUDE</p>
                                <p id="driverLng" class="font-mono text-sm">--</p>
                            </div>
                        </div>
                    </div>

                    <!-- Traffic Inspector Logs (NEW) -->
                    <div id="driverInspectorLogs" class="card animate-fadeInUp"
                        style="opacity: 0; animation-delay: 0.35s;">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold flex items-center gap-2">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                    stroke="var(--accent-police)" stroke-width="2">
                                    <path d="M3 21h18" />
                                    <path d="M5 21V7l8-4 8 4v14" />
                                    <path d="M17 21v-8.5a2.5 2.5 0 0 0-5 0V21" />
                                </svg>
                                Traffic Inspector Logs
                            </h3>
                            <span
                                class="text-xs px-2 py-0.5 rounded bg-[var(--bg-elevated)] border border-[var(--border)] text-[var(--fg-muted)]">Read-Only</span>
                        </div>

                        <div id="inspectorLogContainer"
                            class="space-y-3 h-48 overflow-y-auto pr-2 custom-scrollbar relative">
                            <div
                                class="absolute inset-0 flex items-center justify-center opacity-10 pointer-events-none">
                                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="1">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                                </svg>
                            </div>
                            <p class="text-sm text-[var(--fg-muted)] text-center py-8">Waiting for updates from Traffic
                                Control...</p>
                        </div>
                    </div>

                    <!-- Activity Log -->
                    <div class="card animate-fadeInUp" style="opacity: 0; animation-delay: 0.4s;">
                        <h3 class="font-semibold mb-4 flex items-center gap-2">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent-warning)"
                                stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                <polyline points="14 2 14 8 20 8" />
                                <line x1="16" y1="13" x2="8" y2="13" />
                                <line x1="16" y1="17" x2="8" y2="17" />
                                <polyline points="10 9 9 9 8 9" />
                            </svg>
                            Activity Log
                        </h3>
                        <div id="driverActivityLog" class="space-y-3 max-h-[250px] overflow-y-auto">
                            <div class="flex items-start gap-3 text-sm animate-slideIn">
                                <div class="w-2 h-2 rounded-full bg-[var(--accent-emergency)] mt-1.5"></div>
                                <div>
                                    <p>System initialized</p>
                                    <p class="text-xs text-[var(--fg-muted)]">Just now</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Traffic Police Dashboard -->
    <div id="policeDashboard" class="hidden">
        <!-- Sidebar -->
        <aside class="sidebar" id="policeSidebar">
            <div class="flex items-center gap-3 mb-8">
                <div class="w-10 h-10 rounded-xl bg-[var(--accent-police)] flex items-center justify-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--bg-primary)"
                        stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                    </svg>
                </div>
                <span class="font-bold text-lg">POLICE</span>
            </div>

            <!-- Profile Section -->
            <div class="flex flex-col items-center mb-8">
                <div class="photo-upload" id="policePhotoUpload">
                    <input type="file" id="policePhotoInput" accept="image/*" class="hidden">
                    <img id="policePhotoPreview" class="hidden" alt="Profile photo">
                    <div id="policePhotoPlaceholder" class="text-center">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--fg-muted)"
                            stroke-width="1.5" class="mx-auto mb-1">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                            <circle cx="8.5" cy="8.5" r="1.5" />
                            <polyline points="21 15 16 10 5 21" />
                        </svg>
                        <span class="text-xs text-[var(--fg-muted)]">Upload</span>
                    </div>
                </div>
                <h3 id="policeWelcomeName" class="font-semibold mt-3"></h3>
                <p class="text-sm text-[var(--fg-secondary)]">Traffic Officer</p>
            </div>

            <!-- Navigation -->
            <nav class="flex-1">
                <ul class="space-y-2">
                    <li>
                        <a href="#"
                            class="flex items-center gap-3 px-4 py-3 rounded-xl bg-[var(--bg-elevated)] text-[var(--accent-police)]">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="3" y="3" width="7" height="7" />
                                <rect x="14" y="3" width="7" height="7" />
                                <rect x="14" y="14" width="7" height="7" />
                                <rect x="3" y="14" width="7" height="7" />
                            </svg>
                            Dashboard
                        </a>
                    </li>
                    <li>
                        <a href="#"
                            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-[var(--bg-elevated)] text-[var(--fg-secondary)] transition-colors">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <line x1="12" y1="8" x2="12" y2="12" />
                                <line x1="12" y1="16" x2="12.01" y2="16" />
                            </svg>
                            Signal Control
                        </a>
                    </li>
                    <li>
                        <a href="#"
                            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-[var(--bg-elevated)] text-[var(--fg-secondary)] transition-colors relative">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                                <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                            </svg>
                            Alerts
                            <span id="policeAlertCount"
                                class="ml-auto bg-[var(--accent-alert)] text-white text-xs px-2 py-0.5 rounded-full hidden">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="policeSettingsBtn"
                            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-[var(--bg-elevated)] text-[var(--fg-secondary)] transition-colors">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="3" />
                                <path
                                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                            </svg>
                            Settings
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Logout -->
            <button id="policeLogout" class="btn btn-secondary w-full mt-4">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                    <polyline points="16 17 21 12 16 7" />
                    <line x1="21" y1="12" x2="9" y2="12" />
                </svg>
                Logout
            </button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Mobile Menu Button -->
            <button id="policeMobileMenu"
                class="mobile-menu-btn hidden fixed top-4 left-4 z-50 w-10 h-10 rounded-xl bg-[var(--bg-card)] border border-[var(--border)] items-center justify-center lg:hidden">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12" />
                    <line x1="3" y1="6" x2="21" y2="6" />
                    <line x1="3" y1="18" x2="21" y2="18" />
                </svg>
            </button>

            <!-- Header -->
            <header class="flex items-center justify-between mb-8 animate-fadeInUp">
                <div>
                    <h1 class="text-2xl font-bold">Traffic Control Dashboard</h1>
                    <p class="text-[var(--fg-secondary)]">Monitor and manage traffic signals</p>
                </div>
                <div id="policeCurrentTime" class="text-right">
                    <div class="text-2xl font-bold font-['Space_Grotesk']"></div>
                    <div class="text-sm text-[var(--fg-secondary)]"></div>
                </div>
            </header>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div class="card animate-fadeInUp delay-1" style="opacity: 0;">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-[rgba(0,168,255,0.15)] flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-police)"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <line x1="12" y1="8" x2="12" y2="12" />
                                <line x1="12" y1="16" x2="12.01" y2="16" />
                            </svg>
                        </div>
                        <span class="text-sm text-[var(--fg-secondary)]">Signal ID</span>
                    </div>
                    <p id="policeSignalId" class="text-xl font-bold">--</p>
                </div>

                <div class="card animate-fadeInUp delay-2" style="opacity: 0;">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-[rgba(0,255,136,0.15)] flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-emergency)"
                                stroke-width="2">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                            </svg>
                        </div>
                        <span class="text-sm text-[var(--fg-secondary)]">Signal Status</span>
                    </div>
                    <p id="policeSignalStatusText" class="text-xl font-bold">Normal</p>
                </div>

                <div class="card animate-fadeInUp delay-3" style="opacity: 0;">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-[rgba(255,71,87,0.15)] flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-alert)"
                                stroke-width="2">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                            </svg>
                        </div>
                        <span class="text-sm text-[var(--fg-secondary)]">Ambulances Nearby</span>
                    </div>
                    <p id="policeAmbulanceCount" class="text-xl font-bold">0</p>
                </div>

                <div class="card animate-fadeInUp delay-4" style="opacity: 0;">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-[rgba(255,167,38,0.15)] flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-warning)"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <polyline points="12 6 12 12 16 14" />
                            </svg>
                        </div>
                        <span class="text-sm text-[var(--fg-secondary)]">Green Timer</span>
                    </div>
                    <p id="policeGreenTimer" class="text-xl font-bold">-- <span class="text-sm font-normal">sec</span>
                    </p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Left Column -->
                <div class="space-y-6">
                    <!-- Profile Card -->
                    <div class="card animate-fadeInUp" style="opacity: 0; animation-delay: 0.3s;">
                        <h3 class="font-semibold mb-4 flex items-center gap-2">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent-police)"
                                stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                <circle cx="12" cy="7" r="4" />
                            </svg>
                            Officer Information
                        </h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">Full Name</p>
                                <p id="policeInfoName" class="font-medium">--</p>
                            </div>
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">Phone</p>
                                <p id="policeInfoPhone" class="font-medium">--</p>
                            </div>
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">Force Number</p>
                                <p id="policeInfoForce" class="font-medium">--</p>
                            </div>
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">Assigned Signal</p>
                                <p id="policeInfoSignal" class="font-medium">--</p>
                            </div>
                        </div>
                    </div>

                    <!-- Signal Control -->
                    <div class="card animate-fadeInUp" style="opacity: 0; animation-delay: 0.4s;">
                        <h3 class="font-semibold mb-4 flex items-center gap-2">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent-warning)"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <line x1="12" y1="8" x2="12" y2="12" />
                                <line x1="12" y1="16" x2="12.01" y2="16" />
                            </svg>
                            Signal Control Panel
                        </h3>

                        <div class="flex items-center justify-center gap-8 mb-6">
                            <div class="text-center">
                                <div class="signal-light signal-red mb-2" id="policeSignalRed">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white"
                                        stroke-width="2">
                                        <circle cx="12" cy="12" r="3" />
                                    </svg>
                                </div>
                                <span class="text-xs text-[var(--fg-secondary)]">RED</span>
                            </div>
                            <div class="text-center">
                                <div class="signal-light signal-yellow mb-2 opacity-30" id="policeSignalYellow">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white"
                                        stroke-width="2">
                                        <circle cx="12" cy="12" r="3" />
                                    </svg>
                                </div>
                                <span class="text-xs text-[var(--fg-secondary)]">YELLOW</span>
                            </div>
                            <div class="text-center">
                                <div class="signal-light signal-green mb-2 opacity-30" id="policeSignalGreen">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white"
                                        stroke-width="2">
                                        <circle cx="12" cy="12" r="3" />
                                    </svg>
                                </div>
                                <span class="text-xs text-[var(--fg-secondary)]">GREEN</span>
                            </div>
                        </div>

                        <div id="countdownContainer" class="text-center mb-4 hidden">
                            <p class="text-sm text-[var(--fg-secondary)] mb-2">Green signal active for:</p>
                            <div id="countdownTimer" class="countdown">30</div>
                            <p class="text-sm text-[var(--fg-secondary)]">seconds</p>
                        </div>

                        <div class="grid grid-cols-3 gap-2">
                            <button id="setRedBtn"
                                class="btn btn-secondary text-sm py-3 border-red-500/30 text-red-400">
                                Set Red
                            </button>
                            <button id="setYellowBtn"
                                class="btn btn-secondary text-sm py-3 border-yellow-500/30 text-yellow-400">
                                Set Yellow
                            </button>
                            <button id="setGreenBtn" class="btn btn-primary text-sm py-3">
                                Set Green
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="space-y-6">
                    <!-- Live Location -->
                    <div class="card animate-fadeInUp" style="opacity: 0; animation-delay: 0.3s;">
                        <h3 class="font-semibold mb-4 flex items-center gap-2">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent-police)"
                                stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                                <circle cx="12" cy="10" r="3" />
                            </svg>
                            Live Location Monitor
                        </h3>
                        <div class="map-container">
                            <div class="map-grid"></div>
                            <div id="policeMapMarker" class="map-marker marker-police" style="top: 50%; left: 50%;">
                            </div>
                            <div id="ambulanceMapMarker" class="map-marker marker-ambulance hidden"
                                style="top: 30%; left: 30%;"></div>
                        </div>
                        <div class="mt-4 grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-xs text-[var(--fg-muted)] mb-1">YOUR LOCATION</p>
                                <p id="policeLat" class="font-mono text-sm">--</p>
                            </div>
                            <div>
                                <p class="text-xs text-[var(--fg-muted)] mb-1">AMBULANCE</p>
                                <p id="ambulanceLocationDisplay" class="font-mono text-sm">No ambulance nearby</p>
                            </div>
                        </div>
                    </div>



                    <!-- Live Tracking Module -->
                    <div id="liveTrackingModule" class="card animate-fadeInUp mb-8 hidden">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold flex items-center gap-2">
                                <span class="relative flex h-3 w-3">
                                    <span
                                        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                                    <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                                </span>
                                Ambulance & Location Details
                            </h3>
                            <div
                                class="px-3 py-1 rounded-full bg-[rgba(255,71,87,0.1)] text-[var(--accent-alert)] text-sm font-medium animate-pulse">
                                LIVE TRACKING
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Map View -->
                            <div
                                class="lg:col-span-2 rounded-xl overflow-hidden border border-[var(--border)] relative bg-[var(--bg-secondary)]">
                                <div id="liveMap"></div>
                                <div
                                    class="absolute top-4 right-4 z-[400] bg-[rgba(10,15,20,0.85)] backdrop-blur-md px-3 py-1.5 rounded-lg border border-[var(--border)] text-xs font-mono">
                                    LAT: <span id="liveLat" class="text-[var(--accent-police)]">--.--</span>
                                    LNG: <span id="liveLng" class="text-[var(--accent-police)]">--.--</span>
                                </div>
                            </div>

                            <!-- Data Grid -->
                            <div class="space-y-4">
                                <!-- Vehicle Info -->
                                <div class="bg-[var(--bg-elevated)] p-4 rounded-xl border border-[var(--border)]">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div
                                            class="w-10 h-10 rounded-lg bg-[rgba(0,168,255,0.1)] flex items-center justify-center text-[var(--accent-police)]">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <rect x="1" y="3" width="15" height="13"></rect>
                                                <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                                                <circle cx="5.5" cy="18.5" r="2.5"></circle>
                                                <circle cx="18.5" cy="18.5" r="2.5"></circle>
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="text-xs text-[var(--fg-muted)]">Ambulance ID</p>
                                            <p id="liveAmbId" class="font-bold text-lg">AMB-2049</p>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <p class="text-[var(--fg-muted)]">Driver</p>
                                            <p id="liveDriver" class="font-medium">Rajesh Kumar</p>
                                        </div>
                                        <div>
                                            <p class="text-[var(--fg-muted)]">Type</p>
                                            <p id="liveServiceType" class="font-medium">108 Emergency</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Telemetry -->
                                <div class="grid grid-cols-2 gap-3">
                                    <div
                                        class="bg-[var(--bg-elevated)] p-3 rounded-xl border border-[var(--border)] text-center">
                                        <p class="text-xs text-[var(--fg-muted)] mb-1">Speed</p>
                                        <p id="liveSpeed" class="text-xl font-bold font-['Space_Grotesk']">65 <span
                                                class="text-xs font-normal text-[var(--fg-secondary)]">km/h</span></p>
                                    </div>
                                    <div
                                        class="bg-[var(--bg-elevated)] p-3 rounded-xl border border-[var(--border)] text-center">
                                        <p class="text-xs text-[var(--fg-muted)] mb-1">Distance</p>
                                        <p id="liveDistance" class="text-xl font-bold font-['Space_Grotesk']">4.2 <span
                                                class="text-xs font-normal text-[var(--fg-secondary)]">km</span></p>
                                    </div>
                                </div>

                                <!-- ETA Countdown -->
                                <div
                                    class="bg-[var(--bg-elevated)] p-4 rounded-xl border border-[var(--border)] text-center relative overflow-hidden">
                                    <div id="etaIndicator"
                                        class="absolute top-0 left-0 w-1 h-full bg-[var(--accent-emergency)] transition-colors duration-300">
                                    </div>
                                    <p class="text-xs text-[var(--fg-muted)] mb-1 uppercase tracking-wider">Estimated
                                        Time of Arrival</p>
                                    <p id="liveETA" class="text-3xl font-bold font-['Space_Grotesk']">08:45</p>
                                    <p id="etaStatus" class="text-xs font-medium text-[var(--accent-emergency)] mt-1">On
                                        Time</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Panel -->
                    <div class="card animate-fadeInUp" style="opacity: 0; animation-delay: 0.4s;">
                        <h3 class="font-semibold mb-4 flex items-center gap-2">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent-alert)"
                                stroke-width="2">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                                <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                            </svg>
                            Emergency Notifications
                        </h3>
                        <div id="policeNotifications" class="space-y-3 max-h-[300px] overflow-y-auto">
                            <div class="text-center py-8 text-[var(--fg-muted)]">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="1" class="mx-auto mb-2 opacity-50">
                                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                                    <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                                </svg>
                                <p>No emergency alerts</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

    </div>

    <!-- Hospital Dashboard -->
    <div id="hospitalDashboard" class="hidden">
        <!-- Sidebar -->
        <aside class="sidebar" id="hospitalSidebar">
            <div class="flex items-center gap-3 mb-8">
                <div class="w-10 h-10 rounded-xl bg-[var(--accent-emergency)] flex items-center justify-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--bg-primary)"
                        stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                    </svg>
                </div>
                <span class="font-bold text-lg">HOSPITAL</span>
            </div>

            <!-- Profile Section -->
            <div class="flex flex-col items-center mb-8">
                <div
                    class="w-24 h-24 rounded-full bg-[var(--bg-elevated)] flex items-center justify-center mb-3 border-2 border-[var(--border)]">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--fg-muted)"
                        stroke-width="1.5">
                        <path d="M3 21h18v-8a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v8z" />
                        <path d="M3 10V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v5" />
                        <line x1="12" y1="9" x2="12" y2="15" />
                        <line x1="9" y1="12" x2="15" y2="12" />
                    </svg>
                </div>
                <h3 id="hospitalWelcomeName" class="font-semibold mt-3"></h3>
                <p class="text-sm text-[var(--fg-secondary)]">Hospital Manager</p>
            </div>

            <!-- Navigation -->
            <nav class="flex-1">
                <ul class="space-y-2">
                    <li>
                        <a href="#"
                            class="flex items-center gap-3 px-4 py-3 rounded-xl bg-[var(--bg-elevated)] text-[var(--accent-emergency)]">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="3" y="3" width="7" height="7" />
                                <rect x="14" y="3" width="7" height="7" />
                                <rect x="14" y="14" width="7" height="7" />
                                <rect x="3" y="14" width="7" height="7" />
                            </svg>
                            Dashboard
                        </a>
                    </li>
                    <li>
                        <a href="#"
                            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-[var(--bg-elevated)] text-[var(--fg-secondary)] transition-colors">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                            </svg>
                            Readiness
                        </a>
                    </li>
                    <li>
                        <a href="#" id="hospitalSettingsBtn"
                            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-[var(--bg-elevated)] text-[var(--fg-secondary)] transition-colors">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="3" />
                                <path
                                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                            </svg>
                            Settings
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Logout -->
            <button id="hospitalLogout" class="btn btn-secondary w-full mt-4">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                    <polyline points="16 17 21 12 16 7" />
                    <line x1="21" y1="12" x2="9" y2="12" />
                </svg>
                Logout
            </button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Mobile Menu Button -->
            <button id="hospitalMobileMenu"
                class="mobile-menu-btn hidden fixed top-4 left-4 z-50 w-10 h-10 rounded-xl bg-[var(--bg-card)] border border-[var(--border)] items-center justify-center lg:hidden">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12" />
                    <line x1="3" y1="6" x2="21" y2="6" />
                    <line x1="3" y1="18" x2="21" y2="18" />
                </svg>
            </button>

            <!-- Header -->
            <header class="flex items-center justify-between mb-8 animate-fadeInUp">
                <div>
                    <h1 class="text-2xl font-bold">Hospital Administration</h1>
                    <p class="text-[var(--fg-secondary)]">Manage readiness and incoming cases</p>
                </div>
                <div id="hospitalCurrentTime" class="text-right">
                    <div class="text-2xl font-bold font-['Space_Grotesk']"></div>
                    <div class="text-sm text-[var(--fg-secondary)]"></div>
                </div>
            </header>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div class="card animate-fadeInUp delay-1" style="opacity: 0;">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-[rgba(0,255,136,0.15)] flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-emergency)"
                                stroke-width="2">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                            </svg>
                        </div>
                        <span class="text-sm text-[var(--fg-secondary)]">Overall Status</span>
                    </div>
                    <p id="hospitalStatusDisplay" class="text-xl font-bold text-[var(--accent-emergency)]">Available</p>
                </div>

                <div class="card animate-fadeInUp delay-2" style="opacity: 0;">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-[rgba(0,168,255,0.15)] flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-police)"
                                stroke-width="2">
                                <path d="M3 21h18v-8a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v8z" />
                            </svg>
                        </div>
                        <span class="text-sm text-[var(--fg-secondary)]">Beds Available</span>
                    </div>
                    <p id="hospitalBedsDisplay" class="text-xl font-bold">42</p>
                </div>

                <div class="card animate-fadeInUp delay-3" style="opacity: 0;">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-[rgba(255,167,38,0.15)] flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-warning)"
                                stroke-width="2">
                                <path d="M12 2v20M2 12h20" />
                            </svg>
                        </div>
                        <span class="text-sm text-[var(--fg-secondary)]">ICU Beds</span>
                    </div>
                    <p id="hospitalICUDisplay" class="text-xl font-bold">8</p>
                </div>

                <div class="card animate-fadeInUp delay-4" style="opacity: 0;">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-xl bg-[rgba(255,71,87,0.15)] flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent-alert)"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                            </svg>
                        </div>
                        <span class="text-sm text-[var(--fg-secondary)]">Active Cases</span>
                    </div>
                    <p id="hospitalCasesDisplay" class="text-xl font-bold">0</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Left Column -->
                <div class="space-y-6">
                    <!-- Readiness & Allocation Panel -->
                    <div class="card animate-fadeInUp" style="opacity: 0; animation-delay: 0.3s;">
                        <h3 class="font-semibold mb-4 flex items-center gap-2">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent-emergency)"
                                stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                            </svg>
                            Hospital Readiness & Allocation
                        </h3>
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Emergency
                                        Beds</label>
                                    <input type="number" id="hospBedsInput" class="input-field" value="42">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">ICU
                                        Beds</label>
                                    <input type="number" id="hospICUInput" class="input-field" value="8">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label
                                        class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Ventilators</label>
                                    <input type="number" id="hospVentInput" class="input-field" value="12">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Trauma
                                        Team</label>
                                    <select id="hospTeamInput" class="input-field cursor-pointer">
                                        <option value="Available">Available</option>
                                        <option value="Busy">Busy</option>
                                        <option value="Unavailable">Unavailable</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2 text-[var(--fg-secondary)]">Overall
                                    Status</label>
                                <select id="hospStatusInput" class="input-field cursor-pointer">
                                    <option value="Available">Available</option>
                                    <option value="Busy">Busy</option>
                                    <option value="Full">Full - Divert</option>
                                </select>
                            </div>
                            <button id="updateHospitalStatusBtn" class="btn btn-primary w-full">
                                Update Readiness Status
                            </button>
                        </div>
                    </div>

                    <!-- Hospital Info -->
                    <div class="card animate-fadeInUp" style="opacity: 0; animation-delay: 0.4s;">
                        <h3 class="font-semibold mb-4 flex items-center gap-2">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent-police)"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <line x1="12" y1="16" x2="12" y2="12" />
                                <line x1="12" y1="8" x2="12.01" y2="8" />
                            </svg>
                            Facility Information
                        </h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">Hospital Name</p>
                                <p id="hospInfoName" class="font-medium">--</p>
                            </div>
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">Type</p>
                                <p id="hospInfoType" class="font-medium">--</p>
                            </div>
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">Location</p>
                                <p id="hospInfoLocality" class="font-medium">--</p>
                            </div>
                            <div>
                                <p class="text-sm text-[var(--fg-secondary)]">Manager</p>
                                <p id="hospInfoManager" class="font-medium">--</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="space-y-6">
                    <!-- Incoming Alerts -->
                    <div class="card animate-fadeInUp" style="opacity: 0; animation-delay: 0.3s;">
                        <h3 class="font-semibold mb-4 flex items-center gap-2">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent-alert)"
                                stroke-width="2">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                                <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                            </svg>
                            Incoming Emergency Cases
                        </h3>
                        <div id="hospitalAlertsLog" class="space-y-3 max-h-[300px] overflow-y-auto">
                            <div class="text-center py-8 text-[var(--fg-muted)]">
                                <p>No incoming cases</p>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Log -->
                    <div class="card animate-fadeInUp" style="opacity: 0; animation-delay: 0.4s;">
                        <h3 class="font-semibold mb-4 flex items-center gap-2">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent-warning)"
                                stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                <polyline points="14 2 14 8 20 8" />
                                <line x1="16" y1="13" x2="8" y2="13" />
                                <line x1="16" y1="17" x2="8" y2="17" />
                                <polyline points="10 9 9 9 8 9" />
                            </svg>
                            Activity Log
                        </h3>
                        <div id="hospitalActivityLog" class="space-y-3 max-h-[250px] overflow-y-auto">
                            <div class="flex items-start gap-3 text-sm animate-slideIn">
                                <div class="w-2 h-2 rounded-full bg-[var(--accent-emergency)] mt-1.5"></div>
                                <div>
                                    <p>System initialized</p>
                                    <p class="text-xs text-[var(--fg-muted)]">Just now</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ==========================================
        // APPLICATION STATE & DATA
        // ==========================================

        // Initialize all state variables first
        let currentUser = null;
        let locationUpdateInterval = null;
        let countdownInterval = null;
        let greenTimerValue = 30;
        let driverLocation = { lat: 12.9716, lng: 77.5946 };
        let policeLocation = { lat: 12.9716, lng: 77.5946 };
        let emergencyAlerts = [];
        let isSignalGreen = false;
        let inspectorLogInterval = null;

        // Signal data
        const signals = [
            { id: 'SIG-001', name: 'Main Street Junction', lat: 12.9720, lng: 77.5950, distance: 0.5 },
            { id: 'SIG-002', name: 'Hospital Road Crossing', lat: 12.9730, lng: 77.5960, distance: 1.2 },
            { id: 'SIG-003', name: 'City Center Signal', lat: 12.9740, lng: 77.5970, distance: 2.0 },
            { id: 'SIG-004', name: 'Highway Entry Point', lat: 12.9750, lng: 77.5980, distance: 3.5 }
        ];

        // ==========================================
        // DOM ELEMENTS
        // ==========================================
        const loginPage = document.getElementById('loginPage');
        const driverDashboard = document.getElementById('driverDashboard');
        const policeDashboard = document.getElementById('policeDashboard');
        const settingsModal = document.getElementById('settingsModal');
        const toast = document.getElementById('toast');

        // ==========================================
        // UTILITY FUNCTIONS
        // ==========================================

        function showToast(title, message, type = 'info') {
            const toastEl = document.getElementById('toast');
            const toastIcon = document.getElementById('toast-icon');
            const toastTitle = document.getElementById('toast-title');
            const toastMessage = document.getElementById('toast-message');

            toastTitle.textContent = title;
            toastMessage.textContent = message;

            toastEl.classList.remove('toast-alert');

            if (type === 'alert') {
                toastEl.classList.add('toast-alert');
                toastIcon.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-alert)" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>`;
            } else if (type === 'success') {
                toastIcon.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-emergency)" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>`;
            } else {
                toastIcon.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-police)" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="16" x2="12" y2="12"/>
                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                </svg>`;
            }

            toastEl.classList.add('show');

            setTimeout(() => {
                toastEl.classList.remove('show');
            }, 5000);
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const dateString = now.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });

            const driverTimeEl = document.getElementById('driverCurrentTime');
            const policeTimeEl = document.getElementById('policeCurrentTime');

            if (driverTimeEl) {
                driverTimeEl.innerHTML = `
                    <div class="text-2xl font-bold font-['Space_Grotesk']">${timeString}</div>
                    <div class="text-sm text-[var(--fg-secondary)]">${dateString}</div>
                `;
            }

            if (policeTimeEl) {
                policeTimeEl.innerHTML = `
                    <div class="text-2xl font-bold font-['Space_Grotesk']">${timeString}</div>
                    <div class="text-sm text-[var(--fg-secondary)]">${dateString}</div>
                `;
            }

            const hospitalTimeEl = document.getElementById('hospitalCurrentTime');
            if (hospitalTimeEl) {
                hospitalTimeEl.innerHTML = `
                    <div class="text-2xl font-bold font-['Space_Grotesk']">${timeString}</div>
                    <div class="text-sm text-[var(--fg-secondary)]">${dateString}</div>
                `;
            }
        }

        function generateRandomMovement(base, range = 0.001) {
            return {
                lat: base.lat + (Math.random() - 0.5) * range,
                lng: base.lng + (Math.random() - 0.5) * range
            };
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            return Math.sqrt(Math.pow(lat2 - lat1, 2) + Math.pow(lng2 - lng1, 2)) * 111;
        }

        function addActivityLog(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            if (!container) return;

            const colors = {
                info: 'var(--accent-police)',
                success: 'var(--accent-emergency)',
                warning: 'var(--accent-warning)',
                alert: 'var(--accent-alert)'
            };

            const logEntry = document.createElement('div');
            logEntry.className = 'flex items-start gap-3 text-sm animate-slideIn';
            logEntry.innerHTML = `
                <div class="w-2 h-2 rounded-full mt-1.5" style="background: ${colors[type] || colors.info}"></div>
                <div>
                    <p>${message}</p>
                    <p class="text-xs text-[var(--fg-muted)]">${new Date().toLocaleTimeString()}</p>
                </div>
            `;

            container.insertBefore(logEntry, container.firstChild);

            // Keep only last 20 entries
            while (container.children.length > 20) {
                container.removeChild(container.lastChild);
            }
        }

        // ==========================================
        // TAB SWITCHING
        // ==========================================
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const tab = this.dataset.tab;

                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                document.getElementById('loginTab').classList.toggle('hidden', tab !== 'login');
                document.getElementById('registerTab').classList.toggle('hidden', tab !== 'register');
            });
        });

        // ==========================================
        // ROLE-SPECIFIC FIELDS
        // ==========================================
        document.getElementById('regRole').addEventListener('change', function () {
            document.getElementById('driverFields').classList.toggle('hidden', this.value !== 'driver');
            document.getElementById('policeFields').classList.toggle('hidden', this.value !== 'police');
            document.getElementById('hospitalFields').classList.toggle('hidden', this.value !== 'hospital');
        });

        // ==========================================
        // PHONE VERIFICATION
        // ==========================================
        document.getElementById('verifyPhoneBtn').addEventListener('click', function () {
            const phone = document.getElementById('regPhone').value;
            if (phone.length < 10) {
                showToast('Invalid Phone', 'Please enter a valid phone number', 'alert');
                return;
            }

            document.getElementById('phoneVerifySection').classList.remove('hidden');
            showToast('Code Sent', 'Verification code sent to ' + phone, 'info');
        });

        document.getElementById('confirmVerifyBtn').addEventListener('click', function () {
            const code = document.getElementById('verifyCode').value;
            if (code.length === 6) {
                showToast('Verified', 'Phone number verified successfully', 'success');
                document.getElementById('phoneVerifySection').classList.add('hidden');
            } else {
                showToast('Invalid Code', 'Please enter 6-digit verification code', 'alert');
            }
        });

        // ==========================================
        // LOGIN HANDLER
        // ==========================================
        document.getElementById('loginForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const role = document.getElementById('loginRole').value;

            if (!username || !password || !role) {
                showToast('Missing Fields', 'Please fill in all fields', 'alert');
                return;
            }

            // Create user object
            currentUser = {
                username: username,
                role: role,
                name: username.charAt(0).toUpperCase() + username.slice(1),
                phone: '+1 234 567 8900',
                verified: true
            };

            if (role === 'driver') {
                currentUser.vehicleType = 'Advanced Life Support';
                currentUser.numberPlate = 'AMB-' + Math.floor(Math.random() * 9000 + 1000);
                currentUser.license = 'DL-2024-' + Math.floor(Math.random() * 90000 + 10000);
                showDriverDashboard();
            } else if (role === 'police') {
                currentUser.forceNumber = 'TN-TP-' + Math.floor(Math.random() * 9000 + 1000);
                currentUser.signalId = 'SIG-001';
                currentUser.signalName = 'Main Street Junction';
                showPoliceDashboard();
            } else if (role === 'hospital') {
                currentUser.hospitalName = 'City General Hospital';
                currentUser.hospitalType = 'General';
                currentUser.locality = 'Downtown';
                showHospitalDashboard();
            }

            showToast('Welcome', 'Login successful! Redirecting...', 'success');
        });

        // ==========================================
        // REGISTER HANDLER
        // ==========================================
        document.getElementById('registerForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const name = document.getElementById('regName').value;
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;
            const phone = document.getElementById('regPhone').value;
            const dob = document.getElementById('regDob').value;
            const role = document.getElementById('regRole').value;

            if (!name || !username || !password || !phone || !dob || !role) {
                showToast('Missing Fields', 'Please fill in all required fields', 'alert');
                return;
            }

            currentUser = {
                username: username,
                role: role,
                name: name,
                phone: phone,
                dob: dob,
                verified: true
            };

            if (role === 'driver') {
                currentUser.vehicleType = document.getElementById('regVehicleType').value || 'Basic Ambulance';
                currentUser.numberPlate = document.getElementById('regPlate').value || 'AMB-' + Math.floor(Math.random() * 9000 + 1000);
                currentUser.license = document.getElementById('regLicense').value || 'DL-2024-' + Math.floor(Math.random() * 90000 + 10000);
                showDriverDashboard();
            } else if (role === 'police') {
                currentUser.forceNumber = document.getElementById('regForceNumber').value || 'TN-TP-' + Math.floor(Math.random() * 9000 + 1000);
                const signalSelect = document.getElementById('regSignal');
                currentUser.signalId = signalSelect.value || 'SIG-001';
                currentUser.signalName = signalSelect.options[signalSelect.selectedIndex]?.text || 'Main Street Junction';
                showPoliceDashboard();
            } else if (role === 'hospital') {
                currentUser.hospitalName = document.getElementById('regHospitalName').value || 'City General Hospital';
                currentUser.hospitalType = document.getElementById('regHospitalType').value || 'General';
                currentUser.locality = document.getElementById('regHospitalArea').value || 'Downtown';
                showHospitalDashboard();
            }

            showToast('Account Created', 'Registration successful!', 'success');
        });

        // ==========================================
        // DRIVER DASHBOARD
        // ==========================================
        function showDriverDashboard() {
            loginPage.classList.add('hidden');
            driverDashboard.classList.remove('hidden');
            policeDashboard.classList.add('hidden');

            // Populate driver info
            document.getElementById('driverWelcomeName').textContent = currentUser.name;
            document.getElementById('driverInfoName').textContent = currentUser.name;
            document.getElementById('driverInfoPhone').textContent = currentUser.phone;
            document.getElementById('driverInfoVehicle').textContent = currentUser.vehicleType;
            document.getElementById('driverInfoPlate').textContent = currentUser.numberPlate;
            document.getElementById('driverInfoLicense').textContent = currentUser.license;
            document.getElementById('driverVehicleDisplay').textContent = currentUser.numberPlate;

            // Start location updates
            startLocationUpdates('driver');

            // Update time
            updateTime();
            setInterval(updateTime, 1000);

            // Init Extensions
            initDriverExtensions();
        }

        // Photo upload for driver
        document.getElementById('driverPhotoUpload').addEventListener('click', function () {
            document.getElementById('driverPhotoInput').click();
        });

        document.getElementById('driverPhotoInput').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const preview = document.getElementById('driverPhotoPreview');
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    document.getElementById('driverPhotoPlaceholder').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        // Send Emergency Signal
        document.getElementById('sendEmergencyBtn').addEventListener('click', function () {
            const targetSignal = document.getElementById('targetSignalSelect').value;
            const message = document.getElementById('emergencyMessage').value;

            if (!targetSignal) {
                showToast('Select Signal', 'Please select a target traffic signal', 'alert');
                return;
            }

            // Update driver status
            updateDriverSignalStatus('green');

            // Create emergency alert
            const alert = {
                id: Date.now(),
                type: 'ambulance_approaching',
                signalId: targetSignal,
                message: message || 'Emergency ambulance approaching',
                driverName: currentUser.name,
                vehiclePlate: currentUser.numberPlate,
                timestamp: new Date(),
                distance: Math.random() * 2 + 0.5,
                eta: Math.floor(Math.random() * 5 + 2)
            };

            emergencyAlerts.push(alert);

            // Simulate police receiving alert
            simulatePoliceNotification(alert);
            simulateHospitalNotification(alert);

            showToast('Signal Sent', 'Emergency signal sent to traffic police', 'success');
            addActivityLog('driverActivityLog', 'Emergency signal sent to ' + targetSignal, 'alert');

            // Auto-turn signal green after delay
            setTimeout(() => {
                updateDriverSignalStatus('green');
                showToast('Signal Green', 'Traffic signal turned green. Proceed safely.', 'success');
            }, 3000);
        });

        function updateDriverSignalStatus(status) {
            const statusEl = document.getElementById('driverSignalStatus');
            const lightEl = document.getElementById('driverSignalLight');
            const messageEl = document.getElementById('driverSignalMessage');

            if (status === 'green') {
                statusEl.className = 'status-badge status-green';
                statusEl.innerHTML = '<span class="w-2 h-2 rounded-full bg-current"></span> Green Light';
                lightEl.className = 'signal-light signal-green';
                messageEl.textContent = 'Traffic signal turned green. Proceed safely.';
                isSignalGreen = true;
            } else if (status === 'waiting') {
                statusEl.className = 'status-badge status-waiting';
                statusEl.innerHTML = '<span class="w-2 h-2 rounded-full bg-current"></span> Waiting';
                lightEl.className = 'signal-light signal-red';
                messageEl.textContent = 'Select a signal and send emergency request';
                isSignalGreen = false;
            } else if (status === 'cleared') {
                statusEl.className = 'status-badge status-cleared';
                statusEl.innerHTML = '<span class="w-2 h-2 rounded-full bg-current"></span> Cleared';
                messageEl.textContent = 'Emergency route cleared. Thank you!';
            }
        }

        function initDriverExtensions() {
            // 1. Profile Editing Logic
            const editBtn = document.getElementById('editDriverProfileBtn');
            const cancelBtn = document.getElementById('cancelDriverEditBtn');
            const profileForm = document.getElementById('driverProfileForm');
            const profileView = document.getElementById('driverProfileView');
            const form = document.getElementById('driverProfileForm');

            if (editBtn) {
                editBtn.onclick = () => {
                    document.getElementById('editDriverPhone').value = currentUser.phone;
                    profileView.classList.add('hidden');
                    profileForm.classList.remove('hidden');
                    editBtn.classList.add('hidden');
                };
            }

            if (cancelBtn) {
                cancelBtn.onclick = () => {
                    profileForm.classList.add('hidden');
                    profileView.classList.remove('hidden');
                    editBtn.classList.remove('hidden');
                };
            }

            if (form) {
                form.onsubmit = (e) => {
                    e.preventDefault();
                    const newPhone = document.getElementById('editDriverPhone').value;
                    const newLang = document.getElementById('editDriverLanguage').value;

                    if (newPhone.length < 10) {
                        showToast('Invalid Phone', 'Please enter a valid phone number', 'alert');
                        return;
                    }

                    currentUser.phone = newPhone;
                    currentUser.language = newLang;

                    document.getElementById('driverInfoPhone').textContent = newPhone;
                    document.getElementById('driverInfoLanguage').textContent = newLang;

                    showToast('Profile Updated', 'Your profile details have been saved.', 'success');
                    addActivityLog('driverActivityLog', 'Profile updated successfully', 'success');

                    profileForm.classList.add('hidden');
                    profileView.classList.remove('hidden');
                    editBtn.classList.remove('hidden');
                };
            }

            // 2. Start Inspector Logs Simulation
            if (inspectorLogInterval) clearInterval(inspectorLogInterval);
            simulateInspectorLog(); // Initial
            inspectorLogInterval = setInterval(simulateInspectorLog, 15000);
        }

        function simulateInspectorLog() {
            const container = document.getElementById('inspectorLogContainer');
            if (!container) return;

            if (container.querySelector('svg')) {
                container.innerHTML = '';
            }

            const logs = [
                { type: 'Info', msg: 'Route clear. Proceed with caution.' },
                { type: 'Update', msg: 'Heavy traffic on Main St. Recommendation: Use service lane.' },
                { type: 'Check', msg: 'Speed verification complete. optimal.' },
                { type: 'Signal', msg: 'Green corridor active for 2km.' },
                { type: 'Alert', msg: 'Congestion reported near City Center.' }
            ];

            const randomLog = logs[Math.floor(Math.random() * logs.length)];
            const inspectorId = 'INS-' + Math.floor(Math.random() * 900 + 100);

            const logItem = document.createElement('div');
            logItem.className = 'p-3 bg-[var(--bg-elevated)] rounded-lg border border-[var(--border)] text-sm animate-fadeInUp';
            logItem.innerHTML = `
                <div class="flex justify-between items-start mb-1">
                    <span class="font-semibold text-[var(--accent-police)]">${randomLog.type}</span>
                    <span class="text-xs text-[var(--fg-muted)]">${new Date().toLocaleTimeString()}</span>
                </div>
                <p class="mb-1">${randomLog.msg}</p>
                <p class="text-xs text-[var(--fg-muted)]">By: ${inspectorId}</p>
            `;

            container.insertBefore(logItem, container.firstChild);

            if (container.children.length > 10) container.removeChild(container.lastChild);
        }

        // ==========================================
        // POLICE DASHBOARD
        // ==========================================
        function showPoliceDashboard() {
            loginPage.classList.add('hidden');
            driverDashboard.classList.add('hidden');
            policeDashboard.classList.remove('hidden');

            // Populate police info
            document.getElementById('policeWelcomeName').textContent = currentUser.name;
            document.getElementById('policeInfoName').textContent = currentUser.name;
            document.getElementById('policeInfoPhone').textContent = currentUser.phone;
            document.getElementById('policeInfoForce').textContent = currentUser.forceNumber;
            document.getElementById('policeInfoSignal').textContent = currentUser.signalName;
            document.getElementById('policeSignalId').textContent = currentUser.signalId;

            // Start location updates
            startLocationUpdates('police');

            // Update time
            updateTime();
            setInterval(updateTime, 1000);
        }

        // ==========================================
        // HOSPITAL DASHBOARD
        // ==========================================
        function showHospitalDashboard() {
            loginPage.classList.add('hidden');
            driverDashboard.classList.add('hidden');
            policeDashboard.classList.add('hidden');
            document.getElementById('hospitalDashboard').classList.remove('hidden');

            // Populate Info
            document.getElementById('hospitalWelcomeName').textContent = currentUser.name;
            document.getElementById('hospInfoName').textContent = currentUser.hospitalName;
            document.getElementById('hospInfoType').textContent = currentUser.hospitalType;
            document.getElementById('hospInfoLocality').textContent = currentUser.locality;
            document.getElementById('hospInfoManager').textContent = currentUser.name;

            // Start Time Updates
            updateTime();
            setInterval(updateTime, 1000);

            // Start Live Tracking
            startLiveTracking();
        }

        // Hospital Time Update (hook into existing updateTime or separate)
        // The existing updateTime function needs to be updated to target hospital time element

        // Hospital Readiness Update
        document.getElementById('updateHospitalStatusBtn').addEventListener('click', function () {
            const beds = document.getElementById('hospBedsInput').value;
            const icu = document.getElementById('hospICUInput').value;
            const status = document.getElementById('hospStatusInput').value;

            // Update Displays
            document.getElementById('hospitalBedsDisplay').textContent = beds;
            document.getElementById('hospitalICUDisplay').textContent = icu;
            document.getElementById('hospitalStatusDisplay').textContent = status;

            // Color coding for status
            const statusDisplay = document.getElementById('hospitalStatusDisplay');
            if (status === 'Available') statusDisplay.style.color = 'var(--accent-emergency)';
            else if (status === 'Busy') statusDisplay.style.color = 'var(--accent-warning)';
            else statusDisplay.style.color = 'var(--accent-alert)';

            showToast('Status Updated', 'Hospital readiness status has been updated', 'success');
            addActivityLog('hospitalActivityLog', 'Readiness status updated to ' + status, 'info');
        });

        // Mock Incoming Alert for Hospital
        // We can hook into the existing simulatePoliceNotification to also notify hospital

        // Mobile Menu
        document.getElementById('hospitalMobileMenu').addEventListener('click', function () {
            document.getElementById('hospitalSidebar').classList.toggle('open');
        });

        // Logout
        document.getElementById('hospitalLogout').addEventListener('click', logout);

        // Settings
        document.getElementById('hospitalSettingsBtn').addEventListener('click', (e) => {
            e.preventDefault();
            openSettings();
        });

        // Photo upload for police
        document.getElementById('policePhotoUpload').addEventListener('click', function () {
            document.getElementById('policePhotoInput').click();
        });

        document.getElementById('policePhotoInput').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const preview = document.getElementById('policePhotoPreview');
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    document.getElementById('policePhotoPlaceholder').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        // Signal Control Buttons
        document.getElementById('setRedBtn').addEventListener('click', function () {
            setSignalState('red');
        });

        document.getElementById('setYellowBtn').addEventListener('click', function () {
            setSignalState('yellow');
        });

        document.getElementById('setGreenBtn').addEventListener('click', function () {
            setSignalState('green');
            startGreenCountdown();
        });

        function setSignalState(state) {
            const redLight = document.getElementById('policeSignalRed');
            const yellowLight = document.getElementById('policeSignalYellow');
            const greenLight = document.getElementById('policeSignalGreen');

            // Reset all
            redLight.className = 'signal-light signal-red opacity-30 mb-2';
            yellowLight.className = 'signal-light signal-yellow opacity-30 mb-2';
            greenLight.className = 'signal-light signal-green opacity-30 mb-2';

            if (state === 'red') {
                redLight.classList.remove('opacity-30');
                document.getElementById('policeSignalStatusText').textContent = 'RED';
            } else if (state === 'yellow') {
                yellowLight.classList.remove('opacity-30');
                document.getElementById('policeSignalStatusText').textContent = 'YELLOW';
            } else if (state === 'green') {
                greenLight.classList.remove('opacity-30');
                document.getElementById('policeSignalStatusText').textContent = 'GREEN';
                isSignalGreen = true;
            }
        }

        function startGreenCountdown() {
            const container = document.getElementById('countdownContainer');
            const timerEl = document.getElementById('countdownTimer');
            const timerDisplay = document.getElementById('policeGreenTimer');

            container.classList.remove('hidden');
            greenTimerValue = 30;

            if (countdownInterval) clearInterval(countdownInterval);

            countdownInterval = setInterval(() => {
                greenTimerValue--;
                timerEl.textContent = greenTimerValue;
                timerDisplay.innerHTML = greenTimerValue + ' <span class="text-sm font-normal">sec</span>';

                if (greenTimerValue <= 0) {
                    clearInterval(countdownInterval);
                    container.classList.add('hidden');
                    setSignalState('red');
                    isSignalGreen = false;
                    timerDisplay.innerHTML = '-- <span class="text-sm font-normal">sec</span>';
                }
            }, 1000);
        }

        function simulatePoliceNotification(alert) {
            // This simulates receiving an alert on the police dashboard
            setTimeout(() => {
                const notificationsContainer = document.getElementById('policeNotifications');
                const ambulanceMarker = document.getElementById('ambulanceMapMarker');

                // Clear "no alerts" message
                if (notificationsContainer.querySelector('.text-center')) {
                    notificationsContainer.innerHTML = '';
                }

                // Add notification
                const notification = document.createElement('div');
                notification.className = 'p-4 bg-[var(--bg-elevated)] rounded-xl border border-[var(--accent-alert)] animate-slideIn';
                notification.innerHTML = `
                    <div class="flex items-start justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 rounded-lg bg-[rgba(255,71,87,0.2)] flex items-center justify-center">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent-alert)" stroke-width="2">
                                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                                </svg>
                            </div>
                            <span class="font-semibold text-[var(--accent-alert)]">Emergency Alert</span>
                        </div>
                        <span class="text-xs text-[var(--fg-muted)]">${new Date().toLocaleTimeString()}</span>
                    </div>
                    <p class="text-sm mb-2">${alert.message}</p>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                        <div>
                            <span class="text-[var(--fg-muted)]">Driver:</span>
                            <span class="ml-1">${alert.driverName}</span>
                        </div>
                        <div>
                            <span class="text-[var(--fg-muted)]">Vehicle:</span>
                            <span class="ml-1">${alert.vehiclePlate}</span>
                        </div>
                        <div>
                            <span class="text-[var(--fg-muted)]">Distance:</span>
                            <span class="ml-1">${alert.distance.toFixed(1)} km</span>
                        </div>
                        <div>
                            <span class="text-[var(--fg-muted)]">ETA:</span>
                            <span class="ml-1">${alert.eta} min</span>
                        </div>
                    </div>
                    <button class="btn btn-primary w-full mt-3 text-sm py-2" onclick="acceptEmergency()">
                        Accept and Turn Green
                    </button>
                `;

                notificationsContainer.insertBefore(notification, notificationsContainer.firstChild);

                // Show ambulance marker
                ambulanceMarker.classList.remove('hidden');

                // Update alert count
                const alertCount = document.getElementById('policeAlertCount');
                alertCount.textContent = emergencyAlerts.length;
                alertCount.classList.remove('hidden');

                // Show toast
                if (currentUser && currentUser.role === 'police') {
                    showToast('Emergency Alert', 'Ambulance approaching your signal!', 'alert');
                }
            }, 1000);
        }

        function acceptEmergency() {
            setSignalState('green');
            startGreenCountdown();
            showToast('Signal Activated', 'Green signal activated for emergency vehicle', 'success');

            // Notify driver
            setTimeout(() => {
                if (document.getElementById('driverDashboard') && !document.getElementById('driverDashboard').classList.contains('hidden')) {
                    updateDriverSignalStatus('green');
                }
            }, 500);
        }

        function simulateHospitalNotification(alert) {
            setTimeout(() => {
                const notificationsContainer = document.getElementById('hospitalAlertsLog');

                // Clear "no alerts" message
                if (notificationsContainer.querySelector('.text-center')) {
                    notificationsContainer.innerHTML = '';
                }

                // Add notification
                const notification = document.createElement('div');
                notification.className = 'p-4 bg-[var(--bg-elevated)] rounded-xl border border-[var(--accent-alert)] animate-slideIn';
                notification.innerHTML = `
                    <div class="flex items-start justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 rounded-lg bg-[rgba(255,71,87,0.2)] flex items-center justify-center">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent-alert)" stroke-width="2">
                                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                                </svg>
                            </div>
                            <span class="font-semibold text-[var(--accent-alert)]">Incoming Emergency</span>
                        </div>
                        <span class="text-xs text-[var(--fg-muted)]">${new Date().toLocaleTimeString()}</span>
                    </div>
                    <p class="text-sm mb-2">${alert.message}</p>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                        <div>
                            <span class="text-[var(--fg-muted)]">Driver:</span>
                            <span class="ml-1">${alert.driverName}</span>
                        </div>
                        <div>
                            <span class="text-[var(--fg-muted)]">Vehicle:</span>
                            <span class="ml-1">${alert.vehiclePlate}</span>
                        </div>
                         <div>
                            <span class="text-[var(--fg-muted)]">ETA:</span>
                            <span class="ml-1">${alert.eta} min</span>
                        </div>
                        <div>
                            <span class="text-[var(--fg-muted)]">Condition:</span>
                            <span class="ml-1">Critical</span>
                        </div>
                    </div>
                    <div class="flex gap-2 mt-3">
                        <button class="btn btn-primary flex-1 text-sm py-2" onclick="acknowledgeEmergency('accept')">
                            Prepare Team
                        </button>
                        <button class="btn btn-secondary flex-1 text-sm py-2" onclick="acknowledgeEmergency('redirect')">
                            Redirect
                        </button>
                    </div>
                `;

                notificationsContainer.insertBefore(notification, notificationsContainer.firstChild);

                // Update active cases count
                const casesDisplay = document.getElementById('hospitalCasesDisplay');
                if (casesDisplay) {
                    let count = parseInt(casesDisplay.textContent) || 0;
                    casesDisplay.textContent = count + 1;
                }


                // Show toast
                if (currentUser && currentUser.role === 'hospital') {
                    showToast('Emergency Alert', 'New emergency case incoming!', 'alert');
                }
            }, 1500); // Slightly delayed after police
        }

        function acknowledgeEmergency(action) {
            if (action === 'accept') {
                showToast('Case Accepted', 'Trauma team notified and bed reserved.', 'success');
                addActivityLog('hospitalActivityLog', 'Incoming emergency case accepted', 'success');
            } else {
                showToast('Case Redirected', 'Ambulance advised to divert.', 'warning');
                addActivityLog('hospitalActivityLog', 'Incoming emergency case redirected', 'warning');
            }
        }

        // ==========================================
        // LOCATION UPDATES
        // ==========================================
        function startLocationUpdates(role) {
            if (locationUpdateInterval) clearInterval(locationUpdateInterval);

            locationUpdateInterval = setInterval(() => {
                // Simulate location movement
                if (role === 'driver') {
                    driverLocation = generateRandomMovement(driverLocation, 0.002);
                    updateDriverLocationDisplay();
                } else {
                    policeLocation = generateRandomMovement(policeLocation, 0.0005);
                    updatePoliceLocationDisplay();
                }

                // Update speed randomly
                const speed = Math.floor(Math.random() * 40 + 20);
                const eta = Math.floor(Math.random() * 5 + 2);

                const speedEl = document.getElementById('driverSpeedDisplay');
                const etaEl = document.getElementById('driverEtaDisplay');

                if (speedEl) speedEl.innerHTML = speed + ' <span class="text-sm font-normal">km/h</span>';
                if (etaEl) etaEl.innerHTML = eta + ' <span class="text-sm font-normal">min</span>';

            }, 2000);
        }

        function updateDriverLocationDisplay() {
            const latEl = document.getElementById('driverLat');
            const lngEl = document.getElementById('driverLng');
            const marker = document.getElementById('driverMapMarker');

            if (latEl) latEl.textContent = driverLocation.lat.toFixed(6);
            if (lngEl) lngEl.textContent = driverLocation.lng.toFixed(6);

            // Move marker (scaled for visual effect)
            if (marker) {
                const top = 30 + (driverLocation.lat % 0.01) * 3000;
                const left = 30 + (driverLocation.lng % 0.01) * 3000;
                marker.style.top = Math.max(10, Math.min(90, top)) + '%';
                marker.style.left = Math.max(10, Math.min(90, left)) + '%';
            }
        }

        function updatePoliceLocationDisplay() {
            const latEl = document.getElementById('policeLat');
            const marker = document.getElementById('policeMapMarker');
            const ambulanceMarker = document.getElementById('ambulanceMapMarker');
            const ambulanceDisplay = document.getElementById('ambulanceLocationDisplay');

            if (latEl) latEl.textContent = policeLocation.lat.toFixed(6) + ', ' + policeLocation.lng.toFixed(6);

            // Move police marker
            if (marker) {
                const top = 45 + (policeLocation.lat % 0.005) * 1000;
                const left = 45 + (policeLocation.lng % 0.005) * 1000;
                marker.style.top = Math.max(10, Math.min(90, top)) + '%';
                marker.style.left = Math.max(10, Math.min(90, left)) + '%';
            }

            // Move ambulance marker if visible
            if (ambulanceMarker && !ambulanceMarker.classList.contains('hidden')) {
                driverLocation = generateRandomMovement(driverLocation, 0.003);
                const top = 20 + (driverLocation.lat % 0.01) * 2000;
                const left = 20 + (driverLocation.lng % 0.01) * 2000;
                ambulanceMarker.style.top = Math.max(10, Math.min(90, top)) + '%';
                ambulanceMarker.style.left = Math.max(10, Math.min(90, left)) + '%';

                if (ambulanceDisplay) {
                    ambulanceDisplay.textContent = driverLocation.lat.toFixed(4) + ', ' + driverLocation.lng.toFixed(4);
                }
            }

            // Update ambulance count
            const countEl = document.getElementById('policeAmbulanceCount');
            if (countEl && ambulanceMarker && !ambulanceMarker.classList.contains('hidden')) {
                countEl.textContent = '1';
            }
        }

        // ==========================================
        // LOGOUT HANDLERS
        // ==========================================
        document.getElementById('driverLogout').addEventListener('click', logout);
        document.getElementById('policeLogout').addEventListener('click', logout);

        function logout() {
            if (locationUpdateInterval) clearInterval(locationUpdateInterval);
            if (countdownInterval) clearInterval(countdownInterval);
            if (inspectorLogInterval) clearInterval(inspectorLogInterval);

            currentUser = null;
            emergencyAlerts = [];
            isSignalGreen = false;

            // Reset forms
            document.getElementById('loginForm').reset();
            document.getElementById('registerForm').reset();

            // Show login
            loginPage.classList.remove('hidden');
            driverDashboard.classList.add('hidden');
            policeDashboard.classList.add('hidden');

            showToast('Logged Out', 'You have been logged out successfully', 'info');

            // Hide hospital dashboard
            document.getElementById('hospitalDashboard').classList.add('hidden');
            stopLiveTracking();
        }

        // ==========================================
        // MOBILE MENU TOGGLE
        // ==========================================
        document.getElementById('driverMobileMenu').addEventListener('click', function () {
            document.getElementById('driverSidebar').classList.toggle('open');
        });

        document.getElementById('policeMobileMenu').addEventListener('click', function () {
            document.getElementById('policeSidebar').classList.toggle('open');
        });

        // ==========================================
        // LIVE TRACKING MODULE
        // ==========================================
        let map, ambulanceMarker, polyline;
        let routePath = [
            [12.9716, 77.5946], [12.9720, 77.5950], [12.9730, 77.5960],
            [12.9740, 77.5970], [12.9750, 77.5980], [12.9760, 77.5990],
            [12.9770, 77.6000], [12.9780, 77.6010], [12.9790, 77.6020]
        ];
        let currentRouteIndex = 0;
        let trackingInterval;

        function initLiveMap() {
            if (map) return; // Already initialized

            // Initialize Map
            map = L.map('liveMap', {
                zoomControl: false,
                attributionControl: false
            }).setView([12.9716, 77.5946], 15);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            // Add attribution manually to style it better or leave it hidden as per design needs
            L.control.attribution({
                prefix: false
            }).addTo(map);

            // Custom Icon
            const ambulanceIcon = L.divIcon({
                className: 'custom-div-icon',
                html: `<div style="background-color: var(--accent-alert); width: 12px; height: 12px; border-radius: 50%; box-shadow: 0 0 10px var(--accent-alert); border: 2px solid white;"></div>`,
                iconSize: [12, 12],
                iconAnchor: [6, 6]
            });

            ambulanceMarker = L.marker([12.9716, 77.5946], { icon: ambulanceIcon }).addTo(map);

            // Draw Route
            polyline = L.polyline(routePath, {
                color: 'var(--accent-police)',
                weight: 3,
                opacity: 0.6,
                dashArray: '5, 10'
            }).addTo(map);

            // Fit bounds
            map.fitBounds(polyline.getBounds(), { padding: [20, 20] });
        }

        function startLiveTracking() {
            const module = document.getElementById('liveTrackingModule');
            module.classList.remove('hidden');

            // Initialize map after visibility change
            setTimeout(() => {
                initLiveMap();
                map.invalidateSize();
            }, 100);

            if (trackingInterval) clearInterval(trackingInterval);

            // Simulation Loop
            trackingInterval = setInterval(() => {
                updateLiveStats();
                moveAmbulance();
            }, 2000);
        }

        function stopLiveTracking() {
            document.getElementById('liveTrackingModule').classList.add('hidden');
            if (trackingInterval) clearInterval(trackingInterval);
        }

        function moveAmbulance() {
            if (!map || !ambulanceMarker) return;

            // Simple movement logic along route
            if (currentRouteIndex < routePath.length - 1) {
                const start = routePath[currentRouteIndex];
                const end = routePath[currentRouteIndex + 1];

                // Interpolate for smoother feel (mock)
                const nextPos = end;

                ambulanceMarker.setLatLng(nextPos);
                map.panTo(nextPos);

                // Update Badge Coords
                document.getElementById('liveLat').textContent = nextPos[0].toFixed(4);
                document.getElementById('liveLng').textContent = nextPos[1].toFixed(4);

                currentRouteIndex++;
            } else {
                // Reset route for endless demo
                currentRouteIndex = 0;
            }
        }

        function updateLiveStats() {
            // Randomize Speed
            const speed = Math.floor(Math.random() * (80 - 40) + 40);
            document.getElementById('liveSpeed').innerHTML = `${speed} <span class="text-xs font-normal text-[var(--fg-secondary)]">km/h</span>`;

            // Decrase Distance
            let dist = parseFloat(document.getElementById('liveDistance').innerText);
            if (dist > 0.1) dist -= 0.1;
            else dist = 5.0; // Reset
            document.getElementById('liveDistance').innerHTML = `${dist.toFixed(1)} <span class="text-xs font-normal text-[var(--fg-secondary)]">km</span>`;

            // Update ETA
            updateETA(dist, speed);
        }

        function updateETA(distance, speed) {
            // Time = Distance / Speed * 60 min
            const timeInMin = Math.ceil((distance / speed) * 60);
            const now = new Date();
            now.setMinutes(now.getMinutes() + timeInMin);

            const etaString = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
            document.getElementById('liveETA').textContent = etaString;

            // Color Logic
            const etaIndicator = document.getElementById('etaIndicator');
            const etaStatus = document.getElementById('etaStatus');

            if (timeInMin < 5) {
                etaIndicator.style.backgroundColor = 'var(--accent-alert)';
                etaStatus.textContent = "Critical - Arriving Soon";
                etaStatus.style.color = 'var(--accent-alert)';
            } else if (timeInMin < 10) {
                etaIndicator.style.backgroundColor = 'var(--accent-warning)';
                etaStatus.textContent = "Delay Risk";
                etaStatus.style.color = 'var(--accent-warning)';
            } else {
                etaIndicator.style.backgroundColor = 'var(--accent-emergency)';
                etaStatus.textContent = "On Time";
                etaStatus.style.color = 'var(--accent-emergency)';
            }
        }

        // ==========================================
        // INITIALIZATION
        // ==========================================
        document.addEventListener('DOMContentLoaded', function () {
            updateTime();
            setInterval(updateTime, 1000);

            // Trigger entrance animations
            document.querySelectorAll('.animate-fadeInUp').forEach((el, i) => {
                el.style.animationDelay = (i * 0.1) + 's';
            });
        });

        // Make acceptEmergency available globally
        window.acceptEmergency = acceptEmergency;
        window.acknowledgeEmergency = acknowledgeEmergency;

        // ==========================================
        // SETTINGS MODAL LOGIC
        // ==========================================
        const closeSettingsBtn = document.getElementById('closeSettingsBtn');
        const modalLogoutBtn = document.getElementById('modalLogoutBtn');
        const deleteAccountBtn = document.getElementById('deleteAccountBtn');
        const driverSettingsBtn = document.getElementById('driverSettingsBtn');
        const policeSettingsBtn = document.getElementById('policeSettingsBtn');

        function openSettings() {
            if (!currentUser) return;

            document.getElementById('settingsUsername').textContent = currentUser.name;
            let roleName = 'Ambulance Driver';
            if (currentUser.role === 'police') roleName = 'Traffic Police';
            else if (currentUser.role === 'hospital') roleName = 'Hospital Manager';
            document.getElementById('settingsRole').textContent = roleName;


            // Start Live Tracking for Hospital
            if (roleName === 'Hospital Manager') {
                startLiveTracking();
            } else {
                stopLiveTracking();
            }

            settingsModal.classList.add('active');
        }

        function closeSettings() {
            settingsModal.classList.remove('active');
        }

        // Event Listeners
        driverSettingsBtn.addEventListener('click', (e) => {
            e.preventDefault();
            openSettings();
        });

        policeSettingsBtn.addEventListener('click', (e) => {
            e.preventDefault();
            openSettings();
        });

        closeSettingsBtn.addEventListener('click', closeSettings);

        // Close on clean click outside
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) {
                closeSettings();
            }
        });

        // Logout from Modal
        modalLogoutBtn.addEventListener('click', () => {
            closeSettings();
            logout();
        });

        // Delete Account
        deleteAccountBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                // In a real app, this would delete from backend
                // Here we just clear local state and show a message

                closeSettings();

                if (locationUpdateInterval) clearInterval(locationUpdateInterval);
                if (countdownInterval) clearInterval(countdownInterval);

                currentUser = null;
                emergencyAlerts = [];
                isSignalGreen = false;

                // Reset forms
                document.getElementById('loginForm').reset();
                document.getElementById('registerForm').reset();

                // Show login
                loginPage.classList.remove('hidden');
                driverDashboard.classList.add('hidden');
                policeDashboard.classList.add('hidden');
                document.getElementById('hospitalDashboard').classList.add('hidden');

                showToast('Account Deleted', 'Your account has been successfully deleted.', 'success');
            }
        });
    </script>
</body>

</html>